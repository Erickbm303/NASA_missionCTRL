
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Meteor Impact + Earthquake & Tsunami Interface (Fixed)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root{
      --bg:#0b1020; --card:#12182b; --muted:#9bb0d9; --accent:#4da3ff; --accent2:#18c9b7;
      --line:#1f2942; --good:#22c55e; --warn:#f59e0b; --impact:#42a5f5; --crater:#ff7043; --tsu:#2998ff;
    }
    *{box-sizing:border-box}
    body{margin:0;display:grid;grid-template-columns:420px 1fr;height:100vh;background:var(--bg);color:#dbe7ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    #sidebar{padding:16px;border-right:1px solid var(--line);overflow:auto;background:linear-gradient(180deg,#0b1020 0%, #0e1530 100%)}
    h2{margin:0 0 10px;font-size:20px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:12px;margin-top:-2px;margin-bottom:12px}
    #map{height:100vh;width:100%}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:12px;box-shadow:0 6px 18px rgba(0,0,0,.25)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    label{font-weight:600;font-size:12px;color:#bcd1ff;margin-bottom:6px;display:block}
    input[type="text"],input[type="number"],select{width:100%;background:#0c1224;border:1px solid #202b49;color:#eaf2ff;padding:8px 9px;border-radius:10px;outline:none}
    .btn{background:linear-gradient(90deg,var(--accent),#6ac9ff);border:none;color:#00152e;font-weight:700;padding:10px 12px;border-radius:10px;cursor:pointer}
    .btn.secondary{background:linear-gradient(90deg,var(--accent2),#72f1e8)}
    .btn.gray{background:#233055;color:#cfe1ff}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .legend{display:flex;flex-wrap:wrap;gap:12px;font-size:12px;color:#b4c7f7}
    .sw{width:12px;height:12px;border-radius:3px;display:inline-block;margin-right:6px}
    .sw.crater{background:var(--crater)}
    .sw.tsu{background:var(--tsu)}
    .sw.quake{background:#888}
    .sw.tsunamiEvt{background:#1565c0}
    .sw.city{background:#ffa000}
    .sw.impact{background:#22c55e}
    .result{background:#0e1730;border:1px solid #1a2544;border-radius:12px;padding:10px}
    .muted{color:var(--muted);font-size:12px}
    details{border:1px solid var(--line);border-radius:12px;background:#0e1430}
    summary{padding:8px 10px;cursor:pointer;color:#cfe1ff}
    details>div{padding:8px 10px}
    .list{max-height:140px;overflow:auto;background:#0e1631;border:1px dashed #233055;border-radius:10px;padding:8px}
    .dropzone{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
    .dz{background:#0d142a;border:1px dashed #2a3a6b;padding:10px;border-radius:10px;text-align:center}
    .dz input{width:100%}
    .pill{display:inline-block;background:#13224a;border:1px solid #25407c;color:#9ec4ff;font-size:11px;padding:4px 8px;border-radius:999px}
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Meteor Impact Simulator</h2>
    <div class="sub">NEOs → simulate impact → draw crater & tsunami → overlay earthquakes & tsunami history → list nearby cities.</div>

    <div class="card">
      <label>Cloudflare Worker URL</label>
      <input id="workerUrl" type="text" value="https://ctrl-meteor.erickbm303.workers.dev" placeholder="https://&lt;your-worker&gt;.workers.dev" />
      <div class="muted">Must expose: <span class="pill">/simulate</span> <span class="pill">/story</span> <span class="pill">/save</span></div>
    </div>

    <div class="card">
      <label>Upload Data Files</label>
      <div class="dropzone">
        <div class="dz">
          <div class="muted">NEO (5 highlighted)</div>
          <input id="neoCsv" type="file" accept=".csv" />
        </div>
        <div class="dz">
          <div class="muted">Earthquakes</div>
          <input id="quakesCsv" type="file" accept=".csv" />
        </div>
        <div class="dz">
          <div class="muted">Tsunamis (B,C,D,O,P,Q)</div>
          <input id="tsunamiCsv" type="file" accept=".csv" />
        </div>
      </div>
      <div id="loadStatus" class="muted" style="margin-top:8px">No files loaded.</div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <label>Select Meteor</label>
          <select id="meteorSelect"><option value="">— load NEO CSV —</option></select>
        </div>
        <div>
          <label>Impact Radius (km)</label>
          <input id="radiusKm" type="number" min="1" value="300" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Water Depth (m)</label>
          <input id="waterDepth" type="number" min="0" value="50" />
        </div>
        <div>
          <label>Deflection Δv (m/s)</label>
          <input id="deflection" type="number" min="0" value="0" />
        </div>
      </div>
      <div class="row">
        <div>
          <label>Density (kg/m³)</label>
          <input id="density" type="number" min="100" value="3000" />
        </div>
        <div class="stack" style="align-items:flex-end">
          <button id="simulateBtn" class="btn">Simulate</button>
          <button id="saveBtn" class="btn secondary">Save</button>
        </div>
      </div>
      <div class="legend" style="margin-top:10px">
        <span><span class="sw crater"></span>Crater radius</span>
        <span><span class="sw tsu"></span>Tsunami radius</span>
        <span><span class="sw quake"></span>Earthquakes</span>
        <span><span class="sw tsunamiEvt"></span>Tsunami events</span>
        <span><span class="sw city"></span>Cities</span>
        <span><span class="sw impact"></span>Impact point</span>
      </div>
    </div>

    <div class="card result" id="resultsBox">No simulation yet. Click map to set impact point, choose a meteor, then press <b>Simulate</b>.</div>
    <div class="card result" id="compareBox">No tsunami comparison yet.</div>

    <details class="card" open>
      <summary>Narrative</summary>
      <div id="storyBox" class="muted">—</div>
    </details>

    <details class="card">
      <summary>Earthquakes within radius</summary>
      <div id="quakeSummary" class="muted">—</div>
      <div id="quakeList" class="list"></div>
    </details>

    <details class="card">
      <summary>Tsunamis within radius</summary>
      <div id="tsuSummary" class="muted">—</div>
      <div id="tsuList" class="list"></div>
    </details>

    <details class="card">
      <summary>Cities impacted (≥2 per continent)</summary>
      <div id="citySummary" class="muted">—</div>
      <div id="cityList" class="list"></div>
    </details>
  </div>

  <div id="map"></div>
  <script src="script_meteor.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</body>
</html>
